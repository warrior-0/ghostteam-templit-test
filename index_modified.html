<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>  <title>\uud55c | ê´´ë‹¬ì§€ì˜¥</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="main.js"></script>
  <script type="module">
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
    import { urbanData } from './urban.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAjHwHbHlCi4vgv-Ma0-3kqt-M3SLI_oF4",
      authDomain: "ghost-38f07.firebaseapp.com",
      projectId: "ghost-38f07",
      storageBucket: "ghost-38f07.appspot.com",
      messagingSenderId: "776945022976",
      appId: "1:776945022976:web:105e545d39f12b5d0940e5",
      measurementId: "G-B758ZC971V"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.addEventListener("DOMContentLoaded", async () => {
      const slider = document.getElementById('homeSlider');
      if (!slider || !urbanData) return;

      const popularData = await Promise.all(
        urbanData.map(async (item) => {
          const docSnap = await getDoc(doc(db, 'urbanLikes', String(item.id)));
          const count = docSnap.exists() ? docSnap.data().count || 0 : 0;
          return { ...item, likes: count };
        })
      );

      const sorted = [...popularData].sort((a, b) => b.likes - a.likes).slice(0, 5);

      slider.innerHTML = sorted.map(item => `
        <div class="product-card" data-id="${item.id}">
          <img src="${item.thumb}" alt="${item.title}">
          <div class="product-title">${item.title}</div>
          <div class="rating">${'â˜…'.repeat(item.level)}${'â˜†'.repeat(5 - item.level)}</div>
          <div class="product-price">ì¢‹ì•„ìš” ${item.likes}ê°œ</div>
        </div>
      `).join('');

      document.querySelectorAll('.product-card').forEach(card => {
        card.addEventListener('click', function () {
          const id = this.getAttribute('data-id');
          window.location.href = `urban.html?id=${id}`;
        });
      });

      let idx = 0;
      const visible = 2.3;

      function updateSlider() {
        const card = slider.querySelector('.product-card');
        const cardWidth = card ? card.offsetWidth + 32 : 260;
        slider.style.transform = `translateX(${-idx * cardWidth}px)`;
      }

      document.getElementById('sliderPrev').onclick = function () {
        idx = Math.max(0, idx - 1);
        updateSlider();
      };

      document.getElementById('sliderNext').onclick = function () {
        const card = slider.querySelector('.product-card');
        const cardWidth = card ? card.offsetWidth + 32 : 260;
        const maxIdx = Math.max(0, slider.children.length - Math.ceil(visible));
        idx = Math.min(maxIdx, idx + 1);
        updateSlider();
      };

      updateSlider();
    });
  </script>
</head>
<body>
  <section>
    <h2>ğŸ”¥ ì¸ê¸° ê´´ë‹´ TOP 5</h2>
    <div id="popular-stories"></div>
  </section>
  <header>
    <div class="header-inner">
      <div style="display: flex; align-items: center;">
        <div id="menuContainer"></div>
        <a href="index.html" class="logo">ê´´ë‹´ì§€ì˜¥</a>
        <nav>
          <ul class="gnb">
            <li><a href="index.html">í™ˆ</a></li>
            <li id="urbanMenu">
              <div class="dropdown" tabindex="0">
                <a href="urban.html">ê´´ë‹´</a>
                <span class="dropdown-arrow">&#9660;</span>
              </div>
              <div class="submenu">
                <a href="urban.html?filter=all">ì „ì²´ ê´´ë‹´ ëª¨ìŒ</a>
                <a href="urban.html?filter=korea">í•œêµ­ ê´´ë‹´</a>
                <a href="urban.html?filter=foreign">í•´ì™¸ ê´´ë‹´</a>
                <a href="urban.html?filter=true">ì‹¤í™” ì´ì•¼ê¸°</a>
                <a href="urban.html?filter=user">ì‚¬ìš©ì ì œë³´ ê´´ë‹´</a>
              </div>
            </li>
            <li id="communityMenu">
              <div class="dropdown" tabindex="0">
                <a href="community.html">ì»¤ë®¤ë‹ˆí‹°</a>
                <span class="dropdown-arrow">&#9660;</span>
              </div>
              <div class="submenu">
                <a href="community.html?board=free">ììœ ê²Œì‹œíŒ</a>
                <a href="community.html?board=notice">ì´ë²¤íŠ¸/ê³µì§€</a>
                <a href="community.html?board=archive">ìë£Œì‹¤</a>
              </div>
            </li>
            <li id="aboutMenu">
              <div class="dropdown" tabindex="0">
                <a href="about.html">ì •ë³´</a>
                <span class="dropdown-arrow">&#9660;</span>
              </div>
              <div class="submenu">
                <a href="about.html?page=intro">ì‚¬ì´íŠ¸ ì†Œê°œ</a>
                <a href="about.html?page=greeting">ìš´ì˜ì ì¸ì‚¬ë§</a>
                <a href="about.html?page=contact">ë¬¸ì˜/ì œë³´í•˜ê¸°</a>
              </div>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <section class="hero-section">
      <div class="hero-content">
        <h1>ë‹¤ì–‘í•œ ì´ì•¼ê¸°ì™€ ì»¤ë®¤ë‹ˆí‹°ë¥¼ í†µí•œ<br>ìƒˆë¡œìš´ ê²½í—˜, ì§€ê¸ˆ ì¦ê²¨ë³´ì„¸ìš”!</h1>
        <button class="hero-btn" id="heroActionBtn">ì‹œì‘í•˜ê¸°</button>
      </div>
    </section>

    <section class="main-section" id="popularSection">
      <h2 class="slider-title">ì¸ê¸° ê´´ë‹´</h2>
      <div class="slider-area">
        <div class="slider-arrow" id="sliderPrev">&lt;</div>
        <div class="product-slider-wrapper">
          <div class="product-slider" id="homeSlider"></div>
        </div>
        <div class="slider-arrow" id="sliderNext">&gt;</div>
      </div>
    </section>
  </main>

  <footer>
    &copy; 2025 ê´´ë‹´ì§€ì˜¥. All rights reserved.
  </footer>
</body>
</html>
